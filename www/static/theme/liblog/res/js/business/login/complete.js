function reset(){$(".register-item").removeClass("has-error"),$(".alert-danger").remove()}function resetself(e){var r=e.parents(".register-item");r.removeClass("has-error"),r.find(".alert-danger").remove()}function showError(e,r){var a='<small class="help-block alert alert-danger checkright">'+r+"</small>";e.parents(".register-item").addClass("has-error").append(a)}$("#dosave").click(function(){if(reset(),$("#completeForm").validate({error:function(e,r){showError(e,r),e.one("keyup",function(){$(this).parents(".form-group").removeClass("has-error").find(".errorinfo,.glyphicon-remove").addClass("hidden")})},submitBtn:{flag:!0}})){var e={openid:$("#openid").val(),email:$("#email").val(),name:$("#name").val(),nickname:$("#nickname").val(),pic:$("#pic").val(),way:$("#way").val(),createtime:new Date,__CSRF__:$("#csrf").val()};$.ajax({url:"/home/register/adduser",data:e,type:"POST",success:function(e){0===e.errno?(alert("成功完善个人信息，完善邮件发送到您注册邮箱，请查收！"),window.location.href="/login"):alert(e.errmsg)}})}return!1}),$("#name").on("blur",function(){var r=$(this);if(r.next(".isright").remove(),0<r.val().length){if(resetself(r),r.parents(".register-item").find(".iswrong").remove(),r.next(".isright").remove(),!/^[a-zA-Z0-9_]+$/.test(r.val()))return showError(r,"用户名由数字、字母或下划线组成!"),!1;$.ajax({url:"/register/isexist",data:{name:r.val(),__CSRF__:$("#csrf").val()},type:"POST",success:function(e){0!==e.status?(r.parents(".register-item").find(".iswrong").remove(),r.after('<span class="isright" id="basic-addon1">√</span>')):(r.parents(".register-item").addClass("has-error"),r.after('<span class="iswrong" id="basic-addon1">x</span>'))}})}}),$("#email").on("blur",function(){var r=$(this);r.next(".isright").remove();var e=r.val();if(""!==e){if(resetself(r),r.parents(".register-item").find(".iswrong").remove(),e&&!/^\w+@([0-9a-zA-Z]+[.])+[a-z]{2,4}$/.test(e))return showError(r,"邮箱格式不正确!"),!1;$.ajax({url:"/register/checkemail",data:{email:r.val(),__CSRF__:$("#csrf").val()},type:"POST",success:function(e){0!==e.status?(r.parents(".register-item").find(".iswrong").remove(),r.after('<span class="isright" id="basic-addon1">√</span>')):(r.parents(".register-item").addClass("has-error"),r.after('<span class="iswrong" id="basic-addon1">x</span>'))}})}}),$(document).keyup(function(e){13==e.keyCode&&$("#dosave").trigger("click")});